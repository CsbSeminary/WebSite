<html>

<head>
    
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>

    <link href="styles.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript">

        $(function () {
            $('#coursesTable').tooltip({
                content: function () {
                    return $(this).attr('title');
                }
            });
        });

        function go() {
            var email = document.getElementById("email").value;
            var thumbprint = document.getElementById("webServiceKey").value;
            var path = document.getElementById("startupUrl").value;
            var action = document.getElementById("startupAction").value;
            var params = { 'email': email, 'thumbprint': thumbprint, 'action': action };
            post(path, params, "post");
        }

        function post(path, params, method) {
            method = method || "post"; // Set method to post by default if not specified.

            var form = document.createElement("form");
            form.setAttribute("method", method);
            form.setAttribute("action", path);

            for (var key in params) {
                if (params.hasOwnProperty(key)) {
                    var hiddenField = document.createElement("input");
                    hiddenField.setAttribute("type", "hidden");
                    hiddenField.setAttribute("name", key);
                    hiddenField.setAttribute("value", params[key]);
                    form.appendChild(hiddenField);
                }
            }

            document.body.appendChild(form);
            form.submit();
        }

        function loadCourses() {

            var webServiceUrlInput = document.getElementById("webServiceUrl");
            var webServiceKeyInput = document.getElementById("webServiceKey");

            if (webServiceUrlInput == null || webServiceKeyInput == null) {
                setTimeout(function () { loadCourses(); }, 100);
                return;
            }

            var script = document.createElement("script");
            script.type = "text/javascript";
            script.src = webServiceUrlInput.value + "/GetCourses?apiKey=" + webServiceKeyInput.value + "&registrationEnabled=true&callback=onCoursesLoaded";

            document.getElementsByTagName("body")[0].appendChild(script);
        }

        function onCoursesLoaded(data) {
            if (data.length == 0)
                return;

            var table = document.getElementById("coursesTable");

            for (var i = 0; i < data.length; i++)
                addCourseRow(table, data[i]);

            document.getElementById("coursesRow").style.display = "";
        }

        function addCourseRow(table, course) {
            var row = table.insertRow(table.rows.length);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);

            cell1.innerHTML = course.Title;

            var classDates = "<span class='schedule' title='";

            for (var i = 0; i < course.Classes.length; i++)
            {
                if (i > 0)
                    classDates += "</br>";

                classDates += course.Classes[i].Dates;
            }

            if (course.Classes.length > 0)
                classDates += "'><img style='opacity:0.4; margin-right: 5px; vertical-align: middle;' src='https://www.shiftiq.com/images/icons/20x20/search.png' />" + course.Classes.length + " class" + (course.Classes.length == 1 ? "" : "es") + "</span>";
            else
                classDates += "There are no classes scheduled at this time.'>TBD</span>";

            cell2.innerHTML = "<span class='small-print' style='cursor:pointer;'>" + classDates + "</span>";
        }

        loadCourses();

    </script>

</head>

<body>
    
    <div id="wrapper">
        
        <div id="customer-logo">
            <img src="scc.jpg" />
        </div>

        <h1>Online Registration</h1>
    
        <p>
            Welcome to the SCC online course registration system.
        </p>
        
        <table id="coursesTable" class="style-one">
            <tbody>
                <tr><th style="font-size:1.2em;">Current Course Offerings</th><th style="padding-top:13px;">Schedule</th></tr>
            </tbody>
        </table>
        
        <div class="separator"></div>

        <p class="instructions">
            Please enter your email address and click Continue. 
        </p>
        <p class="instructions">
            If our system recognizes your email address then it will prompt you for a password; otherwise it will prompt you for additional information, such as your first name, last name, mailing address, and telephone number.
        </p>
        <p class="instructions">
            After you sign in, you can select the courses for which you wish to register.
        </p>

        <table cellpadding="3">
            <tr>
                <td>Your Email</td>
                <td><input type="text" id="email" style="width:350px;" value="daniel.miller@insitesystems.com" /></td>
            </tr>
            <tr>
                <td>
                
                </td>
                <td>
                    <a onclick="go();" class="button blue">Continue</a>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    
                </td>
            </tr>
            <tr>
                <td></td>
                <td style="vertical-align: top;">
                    <span class="small-print">powered by</span>
                    <br />
                    <img src="https://www.shiftiq.com/images/logos/shift-small.png" />
                </td>
            </tr>
        </table>

        <table cellpadding="3" style="display:none;">
            <tr><td colspan="2" class="small-print" style="border-top: solid 1px #9FA1A4;">These fields are for testing and demonstration only. They will be replaced with hidden fields on your web site.</td></tr>
            <tr>
                <td>Startup URL</td>
                <td><input type="text" id="startupUrl" style="width:350px;" value="https://test.shiftiq.com/startup.aspx" /> &nbsp; <span class="small-print">Shift iQ startup</span></td>
            </tr>
            <tr>
                <td>Startup Action</td>
                <td><input type="text" id="startupAction" style="width:350px;" value="register-person-courses" /> &nbsp; <span class="small-print">The first screen after authentication</span></td>
            </tr>
            <tr>
                <td>Web Service</td>
                <td><input type="text" id="webServiceUrl" style="width:350px;" value="http://local.shiftiq.com/services.asmx" /> &nbsp; <span class="small-print">Shift iQ web services</span></td>
            </tr>
            <tr>
                <td>API Key</td>
                <td><input type="text" id="webServiceKey" style="width:350px;" value="7b18f15b-921a-4a54-bb42-b189cab2e74a" /> &nbsp; <span class="small-print">SCC Soft Computer</span></td>
            </tr>
        </table>

    </div>

</body>